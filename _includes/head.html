<meta charset="utf-8">

{% include seo.html %}

{% unless site.atom_feed.hide %}
  <link href="{% if site.atom_feed.path %}{{ site.atom_feed.path }}{% else %}{{ '/feed.xml' | relative_url }}{% endif %}" type="application/atom+xml" rel="alternate" title="{{ site.title }} Feed">
{% endunless %}

{%- comment %} https://docs.google.com/presentation/d/1rmxwWa9P6_xHqonmh5ONXRS-jPc5XKbnv99Rjkhe04s/present {% endcomment -%}
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  {% if site.enable_copy_code_button -%}
    window.enable_copy_code_button = true;
  {%- endif %}
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>

{% if site.head_scripts %}
  {% for script in site.head_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 본문 각주 번호만 선택 (sup 안에 있는 링크)
    document.querySelectorAll('sup a[href^="#fn"]').forEach(function (link) {
      const id = link.getAttribute("href").substring(1);
      const footnote = document.getElementById(id);
      if (!footnote) return;

      const text = footnote.innerText.trim().replace(/↩/g, "");
      link.removeAttribute("title");
      link.setAttribute("data-tooltip", text);
      link.classList.add("footnote-tooltip");
  
      function placeTooltip(tooltip, linkRect) {
        // 먼저 보이지 않게 만든 뒤 크기 측정
        tooltip.style.visibility = "hidden";
        tooltip.style.left = "0px";
        tooltip.style.top = "0px";
  
        const tooltipRect = tooltip.getBoundingClientRect();
  
        // 뷰포트 좌표 + 문서 스크롤 보정
        let left =
          linkRect.left +
          linkRect.width / 2 -
          tooltipRect.width / 2 +
          window.scrollX;
        let top = linkRect.bottom + 8 + window.scrollY;
  
        // 좌우 가장자리 보호
        left = Math.max(8 + window.scrollX, Math.min(left, window.scrollX + window.innerWidth - tooltipRect.width - 8));
  
        tooltip.style.left = `${left}px`;
        tooltip.style.top = `${top}px`;
        tooltip.style.visibility = "visible";
      }
  
      function showTooltip() {
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip-popup";
        tooltip.innerText = text;
        document.body.appendChild(tooltip);
  
        const linkRect = link.getBoundingClientRect();
        // 레이아웃 안정화를 위해 다음 프레임에서 배치
        requestAnimationFrame(() => placeTooltip(tooltip, linkRect));
  
        // 스크롤/리사이즈 시 재배치
        function reposition() {
          const rect = link.getBoundingClientRect();
          placeTooltip(tooltip, rect);
        }
        link._tooltip = tooltip;
        link._reposition = reposition;
        window.addEventListener("scroll", reposition, { passive: true });
        window.addEventListener("resize", reposition);
      }
  
      function hideTooltip() {
        if (link._tooltip) {
          window.removeEventListener("scroll", link._reposition);
          window.removeEventListener("resize", link._reposition);
          document.body.removeChild(link._tooltip);
          link._tooltip = null;
          link._reposition = null;
        }
      }
  
      link.addEventListener("mouseenter", showTooltip);
      link.addEventListener("mouseleave", hideTooltip);
      link.addEventListener("blur", hideTooltip); // 키보드 포커스 이탈 대비
    });
  });
  </script>
  